<!-- jQuery data table -->
<script type='text/javascript' src='{{asset("js/paging/jquery-1.4.2.js")}}'></script>
{#<script type='text/javascript' src='{{asset("js/paging/jquery.dataTables.js")}}'></script>#}
{#<link rel="stylesheet" href='{{asset("css/paging/sytletable.css")}}' type="text/css" id="" media="print, projection, screen" />#}
<script>
    $(document).ready(function() {
        $(".btnEditZone").click(function(){
            $("#zoneSH").hide("slow");
            $('#newZone').fadeOut('slow');
            $('#editZone').fadeOut().load(this.href).fadeIn("slow");
            document.getElementById('containerwrap').scrollIntoView(true);
            return false;
        });

        $(".btnDelete").click(function(){
            if (!confirm("คุณต้องการลบ Zone นี้ใช่หรือไม่")){
                return false;
            }
            var url = this.href;
            $.ajax({
                type : "POST",
                url : url,
                data : {checkPost: 'delete'},
                success : function(msg) {
                    if (msg == "finish_math"){
                        alert('!!! Zone นี้มีการใช้งานอยู่ \nไม่สามารถลบออกได้');
                    }else if (msg == 'finish') {
                        $('#innerPanel').fadeOut(100).load("{{ path('zone') }}").fadeIn("slow");
                        alert('√ ทำการลบ Zone เรียบร้อยแล้ว');
                    } else {
                        alert(msg);
                        alert('เกิดการผิดพลาด\n** กรุณาตรวจสอบ **');
                    }
                }
            });
            return false;
        });

        $("#btnNewZone").click(function(){
            $("#zoneSH").hide("slow");
            $('#editZone').fadeOut('slow');
            $('#newZone').fadeOut().load("{{ path('zone_new') }}").fadeIn("slow");
            return false;
        });

        // Paging
        $(".inPage").click(function(){
            var numPage = this.value;
            getHtml(numPage, getOrderBy());
            return false;
        });

        //กำหนดจำนวนหน้า
        $(".record").change(function(){
            var numPage = $(".disableBtn").val();
            getHtml(numPage, getOrderBy());
            return false;
        });

        //ค้นหาด้วยข้อความ
        $("#tbxSearch").change(function(){
            var numPage = 1;
            getHtml(numPage, getOrderBy());
            return false;
        });

        //Order by
        $(".btnOrderBy").click(function(){
            var type = this.id;
            type = type.replace('sort_', '');
            var numPage = $(".disableBtn").val();
            var orderBy = "&orderBy=" + type;
            if (orderByOld == type){
                if (orderByTypeOld == 'asc'){
                    orderBy += "&orderByType=desc";
                }else{
                    orderBy += "&orderByType=asc";
                }
            }else{
                orderBy += "&orderByType=desc";
            }
            getHtml(numPage, orderBy);
            return false;
        });
    });

    // ค่าปัจจุบันในการ sort
    var orderByOld = "{{ orderBy }}";
    var orderByTypeOld = "{{ orderByType }}";

    //get ค่าการ sort ปัจจุบัน
    function getOrderBy(){
        var strOrderBy = "&orderBy=" + orderByOld + "&orderByType=" + orderByTypeOld;
        return strOrderBy;
    }

    //Paging, Sorting, Search
    function getHtml(numPage, orderBy){
        var recordValue = $(".record").val();
        var textSearch = $("#tbxSearch").val();
        var send = "?numPage=" + numPage + "&record=" + recordValue + "&textSearch=" + textSearch + orderBy;
        $.post("{{ path('zone') }}" + send, function(data) {
            $('#innerPanel').html(data);
        });
    }
</script>
<style type="text/css">
    .inPage {
        cursor: pointer;
    }
</style>
<fieldset>
    <h1>Zone list</h1>
    <div id="newZone"></div>
    <div id="editZone"></div>

    <span style="float: right;" id="zoneSH">
        <img src="{{ asset('images/add-bt.png')}}" id="btnNewZone" width="50" height="50" style="cursor:pointer;" />
    </span>
    <div class="clear"></div>
    <br/>
    <fieldset>
        <table style="
        margin: 0 auto;
        clear: both;
        width: 100%;

        border-collapse: collapse;
        border-spacing: 0;
        " border="1" >
            <thead>
                <th><a class="btnOrderBy" href="#" id="sort_id">Id</a></th>
                <th><a class="btnOrderBy" href="#" id="sort_zonename">Zonename</th>
                <th><a class="btnOrderBy" href="#" id="sort_latitude">Latitude</th>
                <th><a class="btnOrderBy" href="#" id="sort_longitude">Longitude</th>
                <th>Actions</th>
            </thead>
            {% for entity in entities %}
                <tr>
                    <td>{{ entity.id }}</td>
                    <td>{{ entity.zonename }}</td>
                    <td>{{ entity.latitude }}</td>
                    <td>{{ entity.longitude }}</td>
                    <td>
                        <ul>
                            <li>
                                <a class="btnEditZone" href="{{ path('zone_edit', { 'id': entity.id }) }}">Edit</a>
                            </li>
                            <li>
                                <a class="btnDelete" href="{{ path('zone_edit', { 'id': entity.id }) }}">Delete</a>
                            </li>
                        </ul>
                    </td>
                </tr>
            {% else %}
                <tr>
                    <td colspan="2"></td>
                    <td align="center">No matching records found</td>
                    <td colspan="2"></td>
                </tr>
            {% endfor %}
        </table>
    </fieldset>
    <div class="paginator">
        <ul>
            <strong>showing {{ countListZone }} entities : Page </strong>
            {% for i in 1..paginator.numpages %}
                {% if paginator.range.0 > 2 and i == paginator.range.0 %}
                    ...
                {% endif %}

                {%  if(i==1 or i==paginator.numpages or i in paginator.range) %}
                    {% if i==paginator.currentpage %}
                        {% if i == noPage %}
                            <input class="disableBtn" type="button" value="{{i}}" id="Submit" name="submitPage" disabled="true"/>
                        {% else %}
                            <input class="inPage" type="button" value="{{i}}" id="Submit" name="submitPage"/>
                        {% endif %}
                    {% else %}
                        {% if i == noPage %}
                        <input class="disableBtn" type="button" value="{{i}}" id="Submit" name="submitPage" disabled="true"/>
                        {% else %}
                        <input class="inPage" type="button" value="{{i}}" id="Submit" name="submitPage"/>
                        {% endif %}
                    {% endif %}
                {% endif %}

                {% if paginator.range[paginator.midrange -1] < paginator.numpages -1 and i == paginator.range[paginator.midrange-1] %}
                    ...
                {% endif %}
            {% endfor %}
            <div align="right" style="float:right;" ><strong>Search:</strong>
                <input id="tbxSearch" style="height: 25px;margin-bottom: 10px;" value="{{ textSearch }}" />&nbsp;&nbsp;
                <select name="record" style="width:150px;" class="record">
                    <option value="10">10 Record </option>
                    {% if limit == '50' %}
                        <option selected="yes" value="50">50 Record</option>
                        <option value="100">100 Record</option>
                        <option value="500">500 Record</option>
                    {% elseif limit == '100' %}
                        <option value="50">50 Record</option>
                        <option selected="yes" value="100">100 Record</option>
                        <option value="500">500 Record</option>
                    {% elseif limit == '500' %}
                        <option value="50">50 Record</option>
                        <option value="100">100 Record</option>
                        <option selected="yes" value="500">500 Record</option>
                    {% else %}
                        <option value="50">50 Record</option>
                        <option value="100">100 Record</option>
                        <option value="500">500 Record</option>
                    {% endif %}
                </select>
            </div>
        </ul>
    </div>
</fieldset>